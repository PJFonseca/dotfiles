#Clears some dirs
function clean(){
	rm -r ~/$DOWNLOAD_FOLDER/* 2> /dev/null
	rm -r ~/$IMAGES_FOLDER/* 2> /dev/null
	rm -rf ~/.local/share/Trash/info/* 2> /dev/null
	rm -rf ~/.local/share/Trash/files/* 2> /dev/null
	
	msgout success "System clean!"
}

#Update host files to block bad hosts
function ublock(){
	sudo wget -O '/etc/hosts' 'https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling-porn/hosts' &> /dev/null && sync &> /dev/null
	msgout success "Hosts updated!"
}
function togglehost() {
    if [ -e /etc/host.bak ]
    then
        sudo mv /etc/host.bak /etc/hosts
        echo "Hosts file is active again"
    else
        sudo mv /etc/hosts /etc/host.bak
        echo "Hosts file is set aside"
    fi
}

function update(){
    DISTRO="$(lsb_release -a | sed -n '3p' | awk '{ print $2 }')"
    if [[ "${DISTRO}" = "Fedora" ]]; then
        sudo dnf -y update --best --allowerasing --skip-broken && sudo dnf -y upgrade --refresh && sudo dnf -y autoremove && sudo dnf -y clean all && backup && ydl_update && clean && ublock
		#Update GNOME Shell Extensions
		gnome-shell-extension-installer --yes --update --restart-shell
	fi;
}

function backup(){
	local destiny=$LINUX_BACKUP_FOLDER

	#Clean Backup dir
	rm -rf $LINUX_BACKUP_FOLDER/*

	if [ ! -d "$LINUX_BACKUP_FOLDER/.config/" ]; then
		mkdir "$LINUX_BACKUP_FOLDER/.config/"
	fi
	#vsCode
	cp -R ~/.config/Code/User $LINUX_BACKUP_FOLDER/.config/Code/

	#DBeaver
	cp -R ~/.dbeaver4 $LINUX_BACKUP_FOLDER/

	#Filezilla
	cp -R ~/.config/filezilla $LINUX_BACKUP_FOLDER/.config/filezilla/
	#Keepassxc
	cp -R ~/.config/keepassxc $LINUX_BACKUP_FOLDER/.config/keepassxc/
	#teamviewer
	cp -R ~/.config/teamviewer $LINUX_BACKUP_FOLDER/.config/teamviewer/
	#VNC
	cp -R ~/.vnc $LINUX_BACKUP_FOLDER/
	#variety
	cp -R ~/.config/variety $LINUX_BACKUP_FOLDER/.config/variety/
	#ssh
	cp -R ~/.ssh $LINUX_BACKUP_FOLDER/.ssh/
	#autostart
	cp -R ~/.config/autostart $LINUX_BACKUP_FOLDER/.config/autostart/
	#remmina
	cp -R ~/.local/share/remmina $LINUX_BACKUP_FOLDER/.local/share/remmina
	cp -R ~/.config/remmina $LINUX_BACKUP_FOLDER/.config/remmina

	#settings
	cd ~/.dotfiles/settings/
	dconf dump /org/gnome/shell/extensions/dash-to-panel/ > dash_to_panel_settings
	dconf dump /org/gnome/shell/extensions/clock_override/ > clock_override_settings
	dconf dump /org/gnome/shell/extensions/panel-osd/ > panel_osd_settings
	dconf dump /org/gnome/shell/extensions/screenshot/ > screenshot_settings
	dconf dump /org/gnome/shell/extensions/openweather/ > openweather_settings
	
	msgout success "Personal Backup done!"
	cd ~/
}

function restore(){
	#Restore files from Dropbox
	cp -R $LINUX_BACKUP_FOLDER/. ~/

	#settings
	cd ~/.dotfiles/settings/
	dconf load /org/gnome/shell/extensions/dash-to-panel/ < dash_to_panel_settings
	dconf load /org/gnome/shell/extensions/clock_override/ < clock_override_settings
	dconf load /org/gnome/shell/extensions/panel-osd/ < panel_osd_settings
	dconf load /org/gnome/shell/extensions/screenshot/ < screenshot_settings
	dconf load /org/gnome/shell/extensions/openweather/ < openweather_settings
	msgout success "Restore done!"
	cd ~/
}